"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var Zt=require("detect-browser"),D=require("@walletconnect/time"),C=require("@walletconnect/window-getters"),Xt=require("@walletconnect/window-metadata"),en=require("query-string"),Te=require("@ethersproject/hash"),tn=require("@ethersproject/transactions"),Ae=require("@stablelib/chacha20poly1305"),nn=require("@stablelib/hkdf"),B=require("@stablelib/random"),H=require("@stablelib/sha256"),rn=require("@stablelib/x25519"),p=require("uint8arrays"),on=require("elliptic"),sn=require("@walletconnect/relay-auth"),an=require("@walletconnect/relay-api");function Ie(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach(function(n){if(n!=="default"){var r=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,r.get?r:{enumerable:!0,get:function(){return e[n]}})}}),t.default=e,Object.freeze(t)}var J=Ie(en),Pe=Ie(rn);const W=":";function ne(e){const[t,n]=e.split(W);return{namespace:t,reference:n}}function Ce(e){const{namespace:t,reference:n}=e;return[t,n].join(W)}function re(e){const[t,n,r]=e.split(W);return{namespace:t,reference:n,address:r}}function $e(e){const{namespace:t,reference:n,address:r}=e;return[t,n,r].join(W)}function oe(e,t){const n=[];return e.forEach(r=>{const o=t(r);n.includes(o)||n.push(o)}),n}function je(e){const{address:t}=re(e);return t}function _e(e){const{namespace:t,reference:n}=re(e);return Ce({namespace:t,reference:n})}function cn(e,t){const{namespace:n,reference:r}=ne(t);return $e({namespace:n,reference:r,address:e})}function un(e){return oe(e,je)}function Ue(e){return oe(e,_e)}function ln(e,t=[]){const n=[];return Object.keys(e).forEach(r=>{if(t.length&&!t.includes(r))return;const o=e[r];n.push(...o.accounts)}),n}function dn(e,t=[]){const n=[];return Object.keys(e).forEach(r=>{if(t.length&&!t.includes(r))return;const o=e[r];n.push(...Ue(o.accounts))}),n}function pn(e,t=[]){const n=[];return Object.keys(e).forEach(r=>{if(t.length&&!t.includes(r))return;const o=e[r];n.push(...z(r,o))}),n}function z(e,t){return e.includes(":")?[e]:t.chains||[]}var fn=Object.defineProperty,De=Object.getOwnPropertySymbols,mn=Object.prototype.hasOwnProperty,gn=Object.prototype.propertyIsEnumerable,Ve=(e,t,n)=>t in e?fn(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,ke=(e,t)=>{for(var n in t||(t={}))mn.call(t,n)&&Ve(e,n,t[n]);if(De)for(var n of De(t))gn.call(t,n)&&Ve(e,n,t[n]);return e};const xe="ReactNative",y={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"},Y=" ",hn=":",Me="/",se=2,yn=1e3,Fe="js";function ie(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}function w(){return!C.getDocument()&&!!C.getNavigator()&&navigator.product===xe}function vn(){return w()&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"&&(global==null?void 0:global.Platform.OS)==="android"}function bn(){return w()&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"&&(global==null?void 0:global.Platform.OS)==="ios"}function M(){return!ie()&&!!C.getNavigator()&&!!C.getDocument()}function $(){return w()?y.reactNative:ie()?y.node:M()?y.browser:y.unknown}function En(){var e;try{return w()&&typeof global<"u"&&typeof(global==null?void 0:global.Application)<"u"?(e=global.Application)==null?void 0:e.applicationId:void 0}catch{return}}function Le(e,t){let n=J.parse(e);return n=ke(ke({},n),t),e=J.stringify(n),e}function Nn(){return Xt.getWindowMetadata()||{name:"",description:"",url:"",icons:[""]}}function On(e,t){var n;const r=$(),o={protocol:e,version:t,env:r};return r==="browser"&&(o.host=((n=C.getLocation())==null?void 0:n.host)||"unknown"),o}function Ke(){if($()===y.reactNative&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"){const{OS:n,Version:r}=global.Platform;return[n,r].join("-")}const e=Zt.detect();if(e===null)return"unknown";const t=e.os?e.os.replace(" ","").toLowerCase():"unknown";return e.type==="browser"?[t,e.name,e.version].join("-"):[t,e.version].join("-")}function qe(){var e;const t=$();return t===y.browser?[t,((e=C.getLocation())==null?void 0:e.host)||"unknown"].join(":"):t}function Be(e,t,n){const r=Ke(),o=qe();return[[e,t].join("-"),[Fe,n].join("-"),r,o].join("/")}function Sn({protocol:e,version:t,relayUrl:n,sdkVersion:r,auth:o,projectId:s,useOnCloseEvent:i,bundleId:u,packageName:l}){const a=n.split("?"),d=Be(e,t,r),c={auth:o,ua:d,projectId:s,useOnCloseEvent:i||void 0,packageName:l||void 0,bundleId:u||void 0},f=Le(a[1]||"",c);return a[0]+"?"+f}function wn(e){let t=(e.match(/^[^:]+(?=:\/\/)/gi)||[])[0];const n=typeof t<"u"?e.split("://")[1]:e;return t=t==="wss"?"https":"http",[t,n].join("://")}function Rn(e,t,n){if(!e[t]||typeof e[t]!==n)throw new Error(`Missing or invalid "${t}" param`)}function He(e,t=se){return Je(e.split(Me),t)}function Tn(e){return He(e).join(Y)}function R(e,t){return e.filter(n=>t.includes(n)).length===e.length}function Je(e,t=se){return e.slice(Math.max(e.length-t,0))}function An(e){return Object.fromEntries(e.entries())}function In(e){return new Map(Object.entries(e))}function Pn(e,t){const n={};return Object.keys(e).forEach(r=>{n[r]=t(e[r])}),n}const Cn=e=>e;function We(e){return e.trim().replace(/^\w/,t=>t.toUpperCase())}function $n(e){return e.split(Y).map(t=>We(t)).join(Y)}function jn(e=D.FIVE_MINUTES,t){const n=D.toMiliseconds(e||D.FIVE_MINUTES);let r,o,s,i;return{resolve:u=>{s&&r&&(clearTimeout(s),r(u),i=Promise.resolve(u))},reject:u=>{s&&o&&(clearTimeout(s),o(u))},done:()=>new Promise((u,l)=>{if(i)return u(i);s=setTimeout(()=>{const a=new Error(t);i=Promise.reject(a),l(a)},n),r=u,o=l})}}function _n(e,t,n){return new Promise(async(r,o)=>{const s=setTimeout(()=>o(new Error(n)),t);try{const i=await e;r(i)}catch(i){o(i)}clearTimeout(s)})}function ae(e,t){if(typeof t=="string"&&t.startsWith(`${e}:`))return t;if(e.toLowerCase()==="topic"){if(typeof t!="string")throw new Error('Value must be "string" for expirer target type: topic');return`topic:${t}`}else if(e.toLowerCase()==="id"){if(typeof t!="number")throw new Error('Value must be "number" for expirer target type: id');return`id:${t}`}throw new Error(`Unknown expirer target type: ${e}`)}function Un(e){return ae("topic",e)}function Dn(e){return ae("id",e)}function Vn(e){const[t,n]=e.split(":"),r={id:void 0,topic:void 0};if(t==="topic"&&typeof n=="string")r.topic=n;else if(t==="id"&&Number.isInteger(Number(n)))r.id=Number(n);else throw new Error(`Invalid target, expected id:number or topic:string, got ${t}:${n}`);return r}function kn(e,t){return D.fromMiliseconds((t||Date.now())+D.toMiliseconds(e))}function xn(e){return Date.now()>=D.toMiliseconds(e)}function Mn(e,t){return`${e}${t?`:${t}`:""}`}function O(e=[],t=[]){return[...new Set([...e,...t])]}async function Fn({id:e,topic:t,wcDeepLink:n}){var r;try{if(!n)return;const o=typeof n=="string"?JSON.parse(n):n,s=o?.href;if(typeof s!="string")return;const i=ze(s,e,t),u=$();if(u===y.browser){if(!((r=C.getDocument())!=null&&r.hasFocus())){console.warn("Document does not have focus, skipping deeplink.");return}i.startsWith("https://")||i.startsWith("http://")?window.open(i,"_blank","noreferrer noopener"):window.open(i,Ye()?"_blank":"_self","noreferrer noopener")}else u===y.reactNative&&typeof(global==null?void 0:global.Linking)<"u"&&await global.Linking.openURL(i)}catch(o){console.error(o)}}function ze(e,t,n){const r=`requestId=${t}&sessionTopic=${n}`;e.endsWith("/")&&(e=e.slice(0,-1));let o=`${e}`;if(e.startsWith("https://t.me")){const s=e.includes("?")?"&startapp=":"?startapp=";o=`${o}${s}${Ge(r,!0)}`}else o=`${o}/wc?${r}`;return o}async function Ln(e,t){let n="";try{if(M()&&(n=localStorage.getItem(t),n))return n;n=await e.getItem(t)}catch(r){console.error(r)}return n}function ce(e,t){return e.filter(n=>t.includes(n))}function Kn(e,t){if(!e.includes(t))return null;const n=e.split(/([&,?,=])/),r=n.indexOf(t);return n[r+2]}function qn(){return typeof crypto<"u"&&crypto!=null&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/gu,e=>{const t=Math.random()*16|0;return(e==="x"?t:t&3|8).toString(16)})}function Bn(){return typeof process<"u"&&process.env.IS_VITEST==="true"}function Ye(){return typeof window<"u"&&(!!window.TelegramWebviewProxy||!!window.Telegram||!!window.TelegramWebviewProxyProto)}function Ge(e,t=!1){const n=Buffer.from(e).toString("base64");return t?n.replace(/[=]/g,""):n}function ue(e){return Buffer.from(e,"base64").toString("utf-8")}function Hn(e){return new Promise(t=>setTimeout(t,e))}const Jn="https://rpc.walletconnect.org/v1";async function Qe(e,t,n,r,o,s){switch(n.t){case"eip191":return Ze(e,t,n.s);case"eip1271":return await Xe(e,t,n.s,r,o,s);default:throw new Error(`verifySignature failed: Attempted to verify CacaoSignature with unknown type: ${n.t}`)}}function Ze(e,t,n){return tn.recoverAddress(Te.hashMessage(t),n).toLowerCase()===e.toLowerCase()}async function Xe(e,t,n,r,o,s){const i=ne(r);if(!i.namespace||!i.reference)throw new Error(`isValidEip1271Signature failed: chainId must be in CAIP-2 format, received: ${r}`);try{const u="0x1626ba7e",l="0000000000000000000000000000000000000000000000000000000000000040",a="0000000000000000000000000000000000000000000000000000000000000041",d=n.substring(2),c=Te.hashMessage(t).substring(2),f=u+c+l+a+d,h=await fetch(`${s||Jn}/?chainId=${r}&projectId=${o}`,{method:"POST",body:JSON.stringify({id:Wn(),jsonrpc:"2.0",method:"eth_call",params:[{to:e,data:f},"latest"]})}),{result:m}=await h.json();return m?m.slice(0,u.length).toLowerCase()===u.toLowerCase():!1}catch(u){return console.error("isValidEip1271Signature: ",u),!1}}function Wn(){return Date.now()+Math.floor(Math.random()*1e3)}var zn=Object.defineProperty,Yn=Object.defineProperties,Gn=Object.getOwnPropertyDescriptors,et=Object.getOwnPropertySymbols,Qn=Object.prototype.hasOwnProperty,Zn=Object.prototype.propertyIsEnumerable,tt=(e,t,n)=>t in e?zn(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,le=(e,t)=>{for(var n in t||(t={}))Qn.call(t,n)&&tt(e,n,t[n]);if(et)for(var n of et(t))Zn.call(t,n)&&tt(e,n,t[n]);return e},nt=(e,t)=>Yn(e,Gn(t));const Xn="did:pkh:",G=e=>e?.split(":"),rt=e=>{const t=e&&G(e);if(t)return e.includes(Xn)?t[3]:t[1]},ot=e=>{const t=e&&G(e);if(t)return t[2]+":"+t[3]},de=e=>{const t=e&&G(e);if(t)return t.pop()};async function er(e){const{cacao:t,projectId:n}=e,{s:r,p:o}=t,s=st(o,o.iss),i=de(o.iss);return await Qe(i,s,r,ot(o.iss),n)}const st=(e,t)=>{const n=`${e.domain} wants you to sign in with your Ethereum account:`,r=de(t);if(!e.aud&&!e.uri)throw new Error("Either `aud` or `uri` is required to construct the message");let o=e.statement||void 0;const s=`URI: ${e.aud||e.uri}`,i=`Version: ${e.version}`,u=`Chain ID: ${rt(t)}`,l=`Nonce: ${e.nonce}`,a=`Issued At: ${e.iat}`,d=e.exp?`Expiration Time: ${e.exp}`:void 0,c=e.nbf?`Not Before: ${e.nbf}`:void 0,f=e.requestId?`Request ID: ${e.requestId}`:void 0,h=e.resources?`Resources:${e.resources.map(g=>`
- ${g}`).join("")}`:void 0,m=Z(e.resources);if(m){const g=T(m);o=me(o,g)}return[n,r,"",o,"",s,i,u,l,a,d,c,f,h].filter(g=>g!=null).join(`
`)};function tr(e,t,n){return n.includes("did:pkh:")||(n=`did:pkh:${n}`),{h:{t:"caip122"},p:{iss:n,domain:e.domain,aud:e.aud,version:e.version,nonce:e.nonce,iat:e.iat,statement:e.statement,requestId:e.requestId,resources:e.resources,nbf:e.nbf,exp:e.exp},s:t}}function nr(e){var t;const{authPayload:n,chains:r,methods:o}=e,s=n.statement||"";if(!(r!=null&&r.length))return n;const i=n.chains,u=ce(i,r);if(!(u!=null&&u.length))throw new Error("No supported chains");const l=it(n.resources);if(!l)return n;N(l);const a=at(l,"eip155");let d=n?.resources||[];if(a!=null&&a.length){const c=ct(a),f=ce(c,o);if(!(f!=null&&f.length))throw new Error(`Supported methods don't satisfy the requested: ${JSON.stringify(c)}, supported: ${JSON.stringify(o)}`);const h=pe("request",f,{chains:u}),m=pt(l,"eip155",h);d=((t=n?.resources)==null?void 0:t.slice(0,-1))||[],d.push(Q(m))}return nt(le({},n),{statement:mt(s,Z(d)),chains:u,resources:n!=null&&n.resources||d.length>0?d:void 0})}function it(e){const t=Z(e);if(t&&fe(t))return T(t)}function rr(e,t){var n;return(n=e?.att)==null?void 0:n.hasOwnProperty(t)}function at(e,t){var n,r;return(n=e?.att)!=null&&n[t]?Object.keys((r=e?.att)==null?void 0:r[t]):[]}function or(e){return e?.map(t=>Object.keys(t))||[]}function ct(e){return e?.map(t=>{var n;return(n=t.split("/"))==null?void 0:n[1]})||[]}function ut(e){return Buffer.from(JSON.stringify(e)).toString("base64")}function lt(e){return JSON.parse(Buffer.from(e,"base64").toString("utf-8"))}function N(e){if(!e)throw new Error("No recap provided, value is undefined");if(!e.att)throw new Error("No `att` property found");const t=Object.keys(e.att);if(!(t!=null&&t.length))throw new Error("No resources found in `att` property");t.forEach(n=>{const r=e.att[n];if(Array.isArray(r))throw new Error(`Resource must be an object: ${n}`);if(typeof r!="object")throw new Error(`Resource must be an object: ${n}`);if(!Object.keys(r).length)throw new Error(`Resource object is empty: ${n}`);Object.keys(r).forEach(o=>{const s=r[o];if(!Array.isArray(s))throw new Error(`Ability limits ${o} must be an array of objects, found: ${s}`);if(!s.length)throw new Error(`Value of ${o} is empty array, must be an array with objects`);s.forEach(i=>{if(typeof i!="object")throw new Error(`Ability limits (${o}) must be an array of objects, found: ${i}`)})})})}function dt(e,t,n,r={}){return n?.sort((o,s)=>o.localeCompare(s)),{att:{[e]:pe(t,n,r)}}}function pt(e,t,n){var r;return e.att[t]=le({},n),((r=Object.keys(e.att))==null?void 0:r.sort((o,s)=>o.localeCompare(s))).reduce((o,s)=>(o.att[s]=e.att[s],o),{att:{}})}function pe(e,t,n={}){t=t?.sort((o,s)=>o.localeCompare(s));const r=t.map(o=>({[`${e}/${o}`]:[n]}));return Object.assign({},...r)}function Q(e){return N(e),`urn:recap:${ut(e).replace(/=/g,"")}`}function T(e){const t=lt(e.replace("urn:recap:",""));return N(t),t}function sr(e,t,n){const r=dt(e,t,n);return Q(r)}function fe(e){return e&&e.includes("urn:recap:")}function ir(e,t){const n=T(e),r=T(t),o=ft(n,r);return Q(o)}function ft(e,t){N(e),N(t);const n=Object.keys(e.att).concat(Object.keys(t.att)).sort((o,s)=>o.localeCompare(s)),r={att:{}};return n.forEach(o=>{var s,i;Object.keys(((s=e.att)==null?void 0:s[o])||{}).concat(Object.keys(((i=t.att)==null?void 0:i[o])||{})).sort((u,l)=>u.localeCompare(l)).forEach(u=>{var l,a;r.att[o]=nt(le({},r.att[o]),{[u]:((l=e.att[o])==null?void 0:l[u])||((a=t.att[o])==null?void 0:a[u])})})}),r}function me(e="",t){N(t);const n="I further authorize the stated URI to perform the following actions on my behalf: ";if(e.includes(n))return e;const r=[];let o=0;Object.keys(t.att).forEach(u=>{const l=Object.keys(t.att[u]).map(c=>({ability:c.split("/")[0],action:c.split("/")[1]}));l.sort((c,f)=>c.action.localeCompare(f.action));const a={};l.forEach(c=>{a[c.ability]||(a[c.ability]=[]),a[c.ability].push(c.action)});const d=Object.keys(a).map(c=>(o++,`(${o}) '${c}': '${a[c].join("', '")}' for '${u}'.`));r.push(d.join(", ").replace(".,","."))});const s=r.join(" "),i=`${n}${s}`;return`${e?e+" ":""}${i}`}function ar(e){var t;const n=T(e);N(n);const r=(t=n.att)==null?void 0:t.eip155;return r?Object.keys(r).map(o=>o.split("/")[1]):[]}function cr(e){const t=T(e);N(t);const n=[];return Object.values(t.att).forEach(r=>{Object.values(r).forEach(o=>{var s;(s=o?.[0])!=null&&s.chains&&n.push(o[0].chains)})}),[...new Set(n.flat())]}function mt(e,t){if(!t)return e;const n=T(t);return N(n),me(e,n)}function Z(e){if(!e)return;const t=e?.[e.length-1];return fe(t)?t:void 0}const ge="base10",v="base16",he="base64pad",ur="base64url",V="utf8",ye=0,k=1,F=2,lr=0,gt=1,L=12,ve=32;function dr(){const e=Pe.generateKeyPair();return{privateKey:p.toString(e.secretKey,v),publicKey:p.toString(e.publicKey,v)}}function pr(){const e=B.randomBytes(ve);return p.toString(e,v)}function fr(e,t){const n=Pe.sharedKey(p.fromString(e,v),p.fromString(t,v),!0),r=new nn.HKDF(H.SHA256,n).expand(ve);return p.toString(r,v)}function mr(e){const t=H.hash(p.fromString(e,v));return p.toString(t,v)}function gr(e){const t=H.hash(p.fromString(e,V));return p.toString(t,v)}function be(e){return p.fromString(`${e}`,ge)}function j(e){return Number(p.toString(e,ge))}function hr(e){const t=be(typeof e.type<"u"?e.type:ye);if(j(t)===k&&typeof e.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");const n=typeof e.senderPublicKey<"u"?p.fromString(e.senderPublicKey,v):void 0,r=typeof e.iv<"u"?p.fromString(e.iv,v):B.randomBytes(L),o=new Ae.ChaCha20Poly1305(p.fromString(e.symKey,v)).seal(r,p.fromString(e.message,V));return Ee({type:t,sealed:o,iv:r,senderPublicKey:n,encoding:e.encoding})}function yr(e,t){const n=be(F),r=B.randomBytes(L),o=p.fromString(e,V);return Ee({type:n,sealed:o,iv:r,encoding:t})}function vr(e){const t=new Ae.ChaCha20Poly1305(p.fromString(e.symKey,v)),{sealed:n,iv:r}=X({encoded:e.encoded,encoding:e?.encoding}),o=t.open(r,n);if(o===null)throw new Error("Failed to decrypt");return p.toString(o,V)}function br(e,t){const{sealed:n}=X({encoded:e,encoding:t});return p.toString(n,V)}function Ee(e){const{encoding:t=he}=e;if(j(e.type)===F)return p.toString(p.concat([e.type,e.sealed]),t);if(j(e.type)===k){if(typeof e.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return p.toString(p.concat([e.type,e.senderPublicKey,e.iv,e.sealed]),t)}return p.toString(p.concat([e.type,e.iv,e.sealed]),t)}function X(e){const{encoded:t,encoding:n=he}=e,r=p.fromString(t,n),o=r.slice(lr,gt),s=gt;if(j(o)===k){const a=s+ve,d=a+L,c=r.slice(s,a),f=r.slice(a,d),h=r.slice(d);return{type:o,sealed:h,iv:f,senderPublicKey:c}}if(j(o)===F){const a=r.slice(s),d=B.randomBytes(L);return{type:o,sealed:a,iv:d}}const i=s+L,u=r.slice(s,i),l=r.slice(i);return{type:o,sealed:l,iv:u}}function Er(e,t){const n=X({encoded:e,encoding:t?.encoding});return ht({type:j(n.type),senderPublicKey:typeof n.senderPublicKey<"u"?p.toString(n.senderPublicKey,v):void 0,receiverPublicKey:t?.receiverPublicKey})}function ht(e){const t=e?.type||ye;if(t===k){if(typeof e?.senderPublicKey>"u")throw new Error("missing sender public key");if(typeof e?.receiverPublicKey>"u")throw new Error("missing receiver public key")}return{type:t,senderPublicKey:e?.senderPublicKey,receiverPublicKey:e?.receiverPublicKey}}function Nr(e){return e.type===k&&typeof e.senderPublicKey=="string"&&typeof e.receiverPublicKey=="string"}function Or(e){return e.type===F}function yt(e){return new on.ec("p256").keyFromPublic({x:Buffer.from(e.x,"base64").toString("hex"),y:Buffer.from(e.y,"base64").toString("hex")},"hex")}function Sr(e){let t=e.replace(/-/g,"+").replace(/_/g,"/");const n=t.length%4;return n>0&&(t+="=".repeat(4-n)),t}function wr(e){return Buffer.from(Sr(e),"base64")}function Rr(e,t){const[n,r,o]=e.split("."),s=wr(o);if(s.length!==64)throw new Error("Invalid signature length");const i=s.slice(0,32).toString("hex"),u=s.slice(32,64).toString("hex"),l=`${n}.${r}`,a=new H.SHA256().update(Buffer.from(l)).digest(),d=yt(t),c=Buffer.from(a).toString("hex");if(!d.verify(c,{r:i,s:u}))throw new Error("Invalid signature");return sn.decodeJWT(e).payload}const vt="irn";function Tr(e){return e?.relay||{protocol:vt}}function Ar(e){const t=an.RELAY_JSONRPC[e];if(typeof t>"u")throw new Error(`Relay Protocol not supported: ${e}`);return t}var Ir=Object.defineProperty,Pr=Object.defineProperties,Cr=Object.getOwnPropertyDescriptors,bt=Object.getOwnPropertySymbols,$r=Object.prototype.hasOwnProperty,jr=Object.prototype.propertyIsEnumerable,Et=(e,t,n)=>t in e?Ir(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Nt=(e,t)=>{for(var n in t||(t={}))$r.call(t,n)&&Et(e,n,t[n]);if(bt)for(var n of bt(t))jr.call(t,n)&&Et(e,n,t[n]);return e},_r=(e,t)=>Pr(e,Cr(t));function Ot(e,t="-"){const n={},r="relay"+t;return Object.keys(e).forEach(o=>{if(o.startsWith(r)){const s=o.replace(r,""),i=e[o];n[s]=i}}),n}function Ur(e){if(!e.includes("wc:")){const l=ue(e);l!=null&&l.includes("wc:")&&(e=l)}e=e.includes("wc://")?e.replace("wc://",""):e,e=e.includes("wc:")?e.replace("wc:",""):e;const t=e.indexOf(":"),n=e.indexOf("?")!==-1?e.indexOf("?"):void 0,r=e.substring(0,t),o=e.substring(t+1,n).split("@"),s=typeof n<"u"?e.substring(n):"",i=J.parse(s),u=typeof i.methods=="string"?i.methods.split(","):void 0;return{protocol:r,topic:St(o[0]),version:parseInt(o[1],10),symKey:i.symKey,relay:Ot(i),methods:u,expiryTimestamp:i.expiryTimestamp?parseInt(i.expiryTimestamp,10):void 0}}function St(e){return e.startsWith("//")?e.substring(2):e}function wt(e,t="-"){const n="relay",r={};return Object.keys(e).forEach(o=>{const s=n+t+o;e[o]&&(r[s]=e[o])}),r}function Dr(e){return`${e.protocol}:${e.topic}@${e.version}?`+J.stringify(Nt(_r(Nt({symKey:e.symKey},wt(e.relay)),{expiryTimestamp:e.expiryTimestamp}),e.methods?{methods:e.methods.join(",")}:{}))}function Vr(e,t,n){return`${e}?wc_ev=${n}&topic=${t}`}var kr=Object.defineProperty,xr=Object.defineProperties,Mr=Object.getOwnPropertyDescriptors,Rt=Object.getOwnPropertySymbols,Fr=Object.prototype.hasOwnProperty,Lr=Object.prototype.propertyIsEnumerable,Tt=(e,t,n)=>t in e?kr(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Kr=(e,t)=>{for(var n in t||(t={}))Fr.call(t,n)&&Tt(e,n,t[n]);if(Rt)for(var n of Rt(t))Lr.call(t,n)&&Tt(e,n,t[n]);return e},qr=(e,t)=>xr(e,Mr(t));function _(e){const t=[];return e.forEach(n=>{const[r,o]=n.split(":");t.push(`${r}:${o}`)}),t}function At(e){const t=[];return Object.values(e).forEach(n=>{t.push(..._(n.accounts))}),t}function It(e,t){const n=[];return Object.values(e).forEach(r=>{_(r.accounts).includes(t)&&n.push(...r.methods)}),n}function Pt(e,t){const n=[];return Object.values(e).forEach(r=>{_(r.accounts).includes(t)&&n.push(...r.events)}),n}function Br(e,t){const n=Ft(e,t);if(n)throw new Error(n.message);const r={};for(const[o,s]of Object.entries(e))r[o]={methods:s.methods,events:s.events,chains:s.accounts.map(i=>`${i.split(":")[0]}:${i.split(":")[1]}`)};return r}function Hr(e){const{proposal:{requiredNamespaces:t,optionalNamespaces:n={}},supportedNamespaces:r}=e,o=Oe(t),s=Oe(n),i={};Object.keys(r).forEach(a=>{const d=r[a].chains,c=r[a].methods,f=r[a].events,h=r[a].accounts;d.forEach(m=>{if(!h.some(g=>g.includes(m)))throw new Error(`No accounts provided for chain ${m} in namespace ${a}`)}),i[a]={chains:d,methods:c,events:f,accounts:h}});const u=Kt(t,i,"approve()");if(u)throw new Error(u.message);const l={};return!Object.keys(t).length&&!Object.keys(n).length?i:(Object.keys(o).forEach(a=>{const d=r[a].chains.filter(m=>{var g,E;return(E=(g=o[a])==null?void 0:g.chains)==null?void 0:E.includes(m)}),c=r[a].methods.filter(m=>{var g,E;return(E=(g=o[a])==null?void 0:g.methods)==null?void 0:E.includes(m)}),f=r[a].events.filter(m=>{var g,E;return(E=(g=o[a])==null?void 0:g.events)==null?void 0:E.includes(m)}),h=d.map(m=>r[a].accounts.filter(g=>g.includes(`${m}:`))).flat();l[a]={chains:d,methods:c,events:f,accounts:h}}),Object.keys(s).forEach(a=>{var d,c,f,h,m,g;if(!r[a])return;const E=(c=(d=s[a])==null?void 0:d.chains)==null?void 0:c.filter(I=>r[a].chains.includes(I)),Yt=r[a].methods.filter(I=>{var P,x;return(x=(P=s[a])==null?void 0:P.methods)==null?void 0:x.includes(I)}),Gt=r[a].events.filter(I=>{var P,x;return(x=(P=s[a])==null?void 0:P.events)==null?void 0:x.includes(I)}),Qt=E?.map(I=>r[a].accounts.filter(P=>P.includes(`${I}:`))).flat();l[a]={chains:O((f=l[a])==null?void 0:f.chains,E),methods:O((h=l[a])==null?void 0:h.methods,Yt),events:O((m=l[a])==null?void 0:m.events,Gt),accounts:O((g=l[a])==null?void 0:g.accounts,Qt)}}),l)}function Ne(e){return e.includes(":")}function Ct(e){return Ne(e)?e.split(":")[0]:e}function Oe(e){var t,n,r;const o={};if(!ee(e))return o;for(const[s,i]of Object.entries(e)){const u=Ne(s)?[s]:i.chains,l=i.methods||[],a=i.events||[],d=Ct(s);o[d]=qr(Kr({},o[d]),{chains:O(u,(t=o[d])==null?void 0:t.chains),methods:O(l,(n=o[d])==null?void 0:n.methods),events:O(a,(r=o[d])==null?void 0:r.events)})}return o}function $t(e){const t={};return e?.forEach(n=>{const[r,o]=n.split(":");t[r]||(t[r]={accounts:[],chains:[],events:[]}),t[r].accounts.push(n),t[r].chains.push(`${r}:${o}`)}),t}function Jr(e,t){t=t.map(r=>r.replace("did:pkh:",""));const n=$t(t);for(const[r,o]of Object.entries(n))o.methods?o.methods=O(o.methods,e):o.methods=e,o.events=["chainChanged","accountsChanged"];return n}const jt={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},_t={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function S(e,t){const{message:n,code:r}=_t[e];return{message:t?`${n} ${t}`:n,code:r}}function U(e,t){const{message:n,code:r}=jt[e];return{message:t?`${n} ${t}`:n,code:r}}function K(e,t){return Array.isArray(e)?typeof t<"u"&&e.length?e.every(t):!0:!1}function ee(e){return Object.getPrototypeOf(e)===Object.prototype&&Object.keys(e).length}function A(e){return typeof e>"u"}function b(e,t){return t&&A(e)?!0:typeof e=="string"&&!!e.trim().length}function te(e,t){return t&&A(e)?!0:typeof e=="number"&&!isNaN(e)}function Wr(e,t){const{requiredNamespaces:n}=t,r=Object.keys(e.namespaces),o=Object.keys(n);let s=!0;return R(o,r)?(r.forEach(i=>{const{accounts:u,methods:l,events:a}=e.namespaces[i],d=_(u),c=n[i];(!R(z(i,c),d)||!R(c.methods,l)||!R(c.events,a))&&(s=!1)}),s):!1}function q(e){return b(e,!1)&&e.includes(":")?e.split(":").length===2:!1}function Ut(e){if(b(e,!1)&&e.includes(":")){const t=e.split(":");if(t.length===3){const n=t[0]+":"+t[1];return!!t[2]&&q(n)}}return!1}function zr(e){function t(n){try{return typeof new URL(n)<"u"}catch{return!1}}try{if(b(e,!1)){if(t(e))return!0;const n=ue(e);return t(n)}}catch{}return!1}function Yr(e){var t;return(t=e?.proposer)==null?void 0:t.publicKey}function Gr(e){return e?.topic}function Qr(e,t){let n=null;return b(e?.publicKey,!1)||(n=S("MISSING_OR_INVALID",`${t} controller public key should be a string`)),n}function Se(e){let t=!0;return K(e)?e.length&&(t=e.every(n=>b(n,!1))):t=!1,t}function Dt(e,t,n){let r=null;return K(t)&&t.length?t.forEach(o=>{r||q(o)||(r=U("UNSUPPORTED_CHAINS",`${n}, chain ${o} should be a string and conform to "namespace:chainId" format`))}):q(e)||(r=U("UNSUPPORTED_CHAINS",`${n}, chains must be defined as "namespace:chainId" e.g. "eip155:1": {...} in the namespace key OR as an array of CAIP-2 chainIds e.g. eip155: { chains: ["eip155:1", "eip155:5"] }`)),r}function Vt(e,t,n){let r=null;return Object.entries(e).forEach(([o,s])=>{if(r)return;const i=Dt(o,z(o,s),`${t} ${n}`);i&&(r=i)}),r}function kt(e,t){let n=null;return K(e)?e.forEach(r=>{n||Ut(r)||(n=U("UNSUPPORTED_ACCOUNTS",`${t}, account ${r} should be a string and conform to "namespace:chainId:address" format`))}):n=U("UNSUPPORTED_ACCOUNTS",`${t}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),n}function xt(e,t){let n=null;return Object.values(e).forEach(r=>{if(n)return;const o=kt(r?.accounts,`${t} namespace`);o&&(n=o)}),n}function Mt(e,t){let n=null;return Se(e?.methods)?Se(e?.events)||(n=U("UNSUPPORTED_EVENTS",`${t}, events should be an array of strings or empty array for no events`)):n=U("UNSUPPORTED_METHODS",`${t}, methods should be an array of strings or empty array for no methods`),n}function we(e,t){let n=null;return Object.values(e).forEach(r=>{if(n)return;const o=Mt(r,`${t}, namespace`);o&&(n=o)}),n}function Zr(e,t,n){let r=null;if(e&&ee(e)){const o=we(e,t);o&&(r=o);const s=Vt(e,t,n);s&&(r=s)}else r=S("MISSING_OR_INVALID",`${t}, ${n} should be an object with data`);return r}function Ft(e,t){let n=null;if(e&&ee(e)){const r=we(e,t);r&&(n=r);const o=xt(e,t);o&&(n=o)}else n=S("MISSING_OR_INVALID",`${t}, namespaces should be an object with data`);return n}function Lt(e){return b(e.protocol,!0)}function Xr(e,t){let n=!1;return t&&!e?n=!0:e&&K(e)&&e.length&&e.forEach(r=>{n=Lt(r)}),n}function eo(e){return typeof e=="number"}function to(e){return typeof e<"u"&&typeof e!==null}function no(e){return!(!e||typeof e!="object"||!e.code||!te(e.code,!1)||!e.message||!b(e.message,!1))}function ro(e){return!(A(e)||!b(e.method,!1))}function oo(e){return!(A(e)||A(e.result)&&A(e.error)||!te(e.id,!1)||!b(e.jsonrpc,!1))}function so(e){return!(A(e)||!b(e.name,!1))}function io(e,t){return!(!q(t)||!At(e).includes(t))}function ao(e,t,n){return b(n,!1)?It(e,t).includes(n):!1}function co(e,t,n){return b(n,!1)?Pt(e,t).includes(n):!1}function Kt(e,t,n){let r=null;const o=uo(e),s=lo(t),i=Object.keys(o),u=Object.keys(s),l=qt(Object.keys(e)),a=qt(Object.keys(t)),d=l.filter(c=>!a.includes(c));return d.length&&(r=S("NON_CONFORMING_NAMESPACES",`${n} namespaces keys don't satisfy requiredNamespaces.
      Required: ${d.toString()}
      Received: ${Object.keys(t).toString()}`)),R(i,u)||(r=S("NON_CONFORMING_NAMESPACES",`${n} namespaces chains don't satisfy required namespaces.
      Required: ${i.toString()}
      Approved: ${u.toString()}`)),Object.keys(t).forEach(c=>{if(!c.includes(":")||r)return;const f=_(t[c].accounts);f.includes(c)||(r=S("NON_CONFORMING_NAMESPACES",`${n} namespaces accounts don't satisfy namespace accounts for ${c}
        Required: ${c}
        Approved: ${f.toString()}`))}),i.forEach(c=>{r||(R(o[c].methods,s[c].methods)?R(o[c].events,s[c].events)||(r=S("NON_CONFORMING_NAMESPACES",`${n} namespaces events don't satisfy namespace events for ${c}`)):r=S("NON_CONFORMING_NAMESPACES",`${n} namespaces methods don't satisfy namespace methods for ${c}`))}),r}function uo(e){const t={};return Object.keys(e).forEach(n=>{var r;n.includes(":")?t[n]=e[n]:(r=e[n].chains)==null||r.forEach(o=>{t[o]={methods:e[n].methods,events:e[n].events}})}),t}function qt(e){return[...new Set(e.map(t=>t.includes(":")?t.split(":")[0]:t))]}function lo(e){const t={};return Object.keys(e).forEach(n=>{if(n.includes(":"))t[n]=e[n];else{const r=_(e[n].accounts);r?.forEach(o=>{t[o]={accounts:e[n].accounts.filter(s=>s.includes(`${o}:`)),methods:e[n].methods,events:e[n].events}})}}),t}function po(e,t){return te(e,!1)&&e<=t.max&&e>=t.min}function fo(){const e=$();return new Promise(t=>{switch(e){case y.browser:t(Bt());break;case y.reactNative:t(Ht());break;case y.node:t(Jt());break;default:t(!0)}})}function Bt(){return M()&&navigator?.onLine}async function Ht(){if(w()&&typeof global<"u"&&global!=null&&global.NetInfo){const e=await(global==null?void 0:global.NetInfo.fetch());return e?.isConnected}return!0}function Jt(){return!0}function mo(e){switch($()){case y.browser:Wt(e);break;case y.reactNative:zt(e);break;case y.node:break}}function Wt(e){!w()&&M()&&(window.addEventListener("online",()=>e(!0)),window.addEventListener("offline",()=>e(!1)))}function zt(e){w()&&typeof global<"u"&&global!=null&&global.NetInfo&&global?.NetInfo.addEventListener(t=>e(t?.isConnected))}const Re={};class go{static get(t){return Re[t]}static set(t,n){Re[t]=n}static delete(t){delete Re[t]}}exports.BASE10=ge,exports.BASE16=v,exports.BASE64=he,exports.BASE64URL=ur,exports.COLON=hn,exports.DEFAULT_DEPTH=se,exports.EMPTY_SPACE=Y,exports.ENV_MAP=y,exports.INTERNAL_ERRORS=_t,exports.MemoryStore=go,exports.ONE_THOUSAND=yn,exports.REACT_NATIVE_PRODUCT=xe,exports.RELAYER_DEFAULT_PROTOCOL=vt,exports.SDK_ERRORS=jt,exports.SDK_TYPE=Fe,exports.SLASH=Me,exports.TYPE_0=ye,exports.TYPE_1=k,exports.TYPE_2=F,exports.UTF8=V,exports.addResourceToRecap=pt,exports.appendToQueryString=Le,exports.assertType=Rn,exports.assignAbilityToActions=pe,exports.base64Decode=lt,exports.base64Encode=ut,exports.buildApprovedNamespaces=Hr,exports.buildAuthObject=tr,exports.buildNamespacesFromAuth=Jr,exports.buildRecapStatement=mt,exports.calcExpiry=kn,exports.capitalize=$n,exports.capitalizeWord=We,exports.createDelayedPromise=jn,exports.createEncodedRecap=sr,exports.createExpiringPromise=_n,exports.createRecap=dt,exports.decodeRecap=T,exports.decodeTypeByte=j,exports.decodeTypeTwoEnvelope=br,exports.decrypt=vr,exports.deriveSymKey=fr,exports.deserialize=X,exports.encodeRecap=Q,exports.encodeTypeByte=be,exports.encodeTypeTwoEnvelope=yr,exports.encrypt=hr,exports.engineEvent=Mn,exports.enumify=Cn,exports.formatAccountId=$e,exports.formatAccountWithChain=cn,exports.formatChainId=Ce,exports.formatDeeplinkUrl=ze,exports.formatExpirerTarget=ae,exports.formatIdTarget=Dn,exports.formatMessage=st,exports.formatMessageContext=Tn,exports.formatRelayParams=wt,exports.formatRelayRpcUrl=Sn,exports.formatStatementFromRecap=me,exports.formatTopicTarget=Un,exports.formatUA=Be,exports.formatUri=Dr,exports.fromBase64=ue,exports.generateKeyPair=dr,exports.generateRandomBytes32=pr,exports.getAccountsChains=_,exports.getAccountsFromNamespaces=ln,exports.getAddressFromAccount=je,exports.getAddressesFromAccounts=un,exports.getAppId=En,exports.getAppMetadata=Nn,exports.getBrowserOnlineStatus=Bt,exports.getChainFromAccount=_e,exports.getChainsFromAccounts=Ue,exports.getChainsFromNamespace=z,exports.getChainsFromNamespaces=dn,exports.getChainsFromRecap=cr,exports.getChainsFromRequiredNamespaces=pn,exports.getCommonValuesInArrays=ce,exports.getCryptoKeyFromKeyData=yt,exports.getDecodedRecapFromResources=it,exports.getDeepLink=Ln,exports.getDidAddress=de,exports.getDidAddressSegments=G,exports.getDidChainId=rt,exports.getEnvironment=$,exports.getHttpUrl=wn,exports.getInternalError=S,exports.getJavascriptID=qe,exports.getJavascriptOS=Ke,exports.getLastItems=Je,exports.getLinkModeURL=Vr,exports.getMethodsFromRecap=ar,exports.getNamespacedDidChainId=ot,exports.getNamespacesChains=At,exports.getNamespacesEventsForChainId=Pt,exports.getNamespacesFromAccounts=$t,exports.getNamespacesMethodsForChainId=It,exports.getNodeOnlineStatus=Jt,exports.getReCapActions=ct,exports.getReactNativeOnlineStatus=Ht,exports.getRecapAbilitiesFromResource=or,exports.getRecapFromResources=Z,exports.getRecapResource=at,exports.getRelayClientMetadata=On,exports.getRelayProtocolApi=Ar,exports.getRelayProtocolName=Tr,exports.getRequiredNamespacesFromNamespaces=Br,exports.getSdkError=U,exports.getSearchParamFromURL=Kn,exports.getUniqueValues=oe,exports.handleDeeplinkRedirect=Fn,exports.hasOverlap=R,exports.hashKey=mr,exports.hashMessage=gr,exports.isAndroid=vn,exports.isBrowser=M,exports.isCaipNamespace=Ne,exports.isConformingNamespaces=Kt,exports.isExpired=xn,exports.isIos=bn,exports.isNode=ie,exports.isOnline=fo,exports.isProposalStruct=Yr,exports.isReactNative=w,exports.isRecap=fe,exports.isSessionCompatible=Wr,exports.isSessionStruct=Gr,exports.isTelegram=Ye,exports.isTestRun=Bn,exports.isTypeOneEnvelope=Nr,exports.isTypeTwoEnvelope=Or,exports.isUndefined=A,exports.isValidAccountId=Ut,exports.isValidAccounts=kt,exports.isValidActions=Mt,exports.isValidArray=K,exports.isValidChainId=q,exports.isValidChains=Dt,exports.isValidController=Qr,exports.isValidEip1271Signature=Xe,exports.isValidEip191Signature=Ze,exports.isValidErrorReason=no,exports.isValidEvent=so,exports.isValidId=eo,exports.isValidNamespaceAccounts=xt,exports.isValidNamespaceActions=we,exports.isValidNamespaceChains=Vt,exports.isValidNamespaceMethodsOrEvents=Se,exports.isValidNamespaces=Ft,exports.isValidNamespacesChainId=io,exports.isValidNamespacesEvent=co,exports.isValidNamespacesRequest=ao,exports.isValidNumber=te,exports.isValidObject=ee,exports.isValidParams=to,exports.isValidRecap=N,exports.isValidRelay=Lt,exports.isValidRelays=Xr,exports.isValidRequest=ro,exports.isValidRequestExpiry=po,exports.isValidRequiredNamespaces=Zr,exports.isValidResponse=oo,exports.isValidString=b,exports.isValidUrl=zr,exports.mapEntries=Pn,exports.mapToObj=An,exports.mergeArrays=O,exports.mergeEncodedRecaps=ir,exports.mergeRecaps=ft,exports.normalizeNamespaces=Oe,exports.objToMap=In,exports.parseAccountId=re,exports.parseChainId=ne,exports.parseContextNames=He,exports.parseExpirerTarget=Vn,exports.parseNamespaceKey=Ct,exports.parseRelayParams=Ot,exports.parseTopic=St,exports.parseUri=Ur,exports.populateAuthPayload=nr,exports.recapHasResource=rr,exports.serialize=Ee,exports.sleep=Hn,exports.subscribeToBrowserNetworkChange=Wt,exports.subscribeToNetworkChange=mo,exports.subscribeToReactNativeNetworkChange=zt,exports.toBase64=Ge,exports.uuidv4=qn,exports.validateDecoding=Er,exports.validateEncoding=ht,exports.validateSignedCacao=er,exports.verifyP256Jwt=Rr,exports.verifySignature=Qe;
//# sourceMappingURL=index.cjs.js.map
